/**
 * MyMoney - main.min.js
 * Copyright (c) edisonlee55
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var fdb=new ForerunnerDB,db=fdb.db("MyMoneyDB"),collection=db.collection("MyMoneyCollection");collection.load(),"en"==mymoneyLanguage?$.getJSON("package.json",a=>{var b=a.version;$("#mymoneyVersion").text(b)}):$.getJSON("../package.json",a=>{var b=a.version;$("#mymoneyVersion").text(b)});var nowPage="home.html",removeRecord=a=>{collection.remove({_id:{$eq:a}}),collection.save(),"search.html"==nowPage?$("#submit").trigger("click"):callPage(nowPage)},callCheck=()=>{$(".ui.dropdown").dropdown(),"add.html"==nowPage&&$("#submit").click(function(){$("#date-input").attr("class","field"),$("#name-input").attr("class","field"),$("#price-input").attr("class","field"),$("#category-select").attr("class","ui selection dropdown"),$("#saving").append("<div class=\"ui icon message\"><i class=\"notched circle loading icon\"></i><div class=\"content\"><div class=\"header\">Saving...</div><p>Please Wait</p></div></div>");var a=$("#date").val(),b=$("#name").val(),c=$("#category-select").dropdown("get value"),d=$("#price").val(),e=!0;if(!0===e){if(""===a){$("#date-input").attr("class","field error");var f=!0;$("#saving").empty()}else var f=!1;if(""===b){$("#name-input").attr("class","field error");var g=!0;$("#saving").empty()}else var g=!1;if(""===c){$("#category-select").attr("class","ui selection dropdown error");var h=!0;$("#saving").empty()}else var h=!1;if(""===d){$("#price-input").attr("class","field error");var i=!0;$("#saving").empty()}else var i=!1;if(!0!==$.isNumeric(d)){$("#price-input").attr("class","field error");var j=!0;$("#saving").empty()}else var j=!1;!1===f&&!1===g&&!1===h&&!1===i&&!1===j&&(e=!1)}!1===e&&(collection.insert({date:a,name:b,category:c,price:d}),collection.save(),$("#page-header").append("<div class=\"ui success message\"><i class=\"close icon\"></i><div class=\"header\">Record Success!</div><p>Expense saved to the database</p></div>"),$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")}),$("#saving").empty())}),"10-expense.html"==nowPage&&collection.load(function(){for(var a=collection.find({},{$orderBy:{timestamp:-1},$limit:10}),b=0;b<a.length;b++)$("tbody").append(`<tr><td>${a[b].date}</td><td>${a[b].name}</td><td>${a[b].price}</td><td><button type="button" class="btn btn-danger" onclick="removeRecord('${a[b]._id}')"><i class="fas fa-trash-alt"></i></button></td></tr>`)}),"search.html"==nowPage&&$("#submit").on("click",function(){var a=$("input[name='mode']:checked").val(),b="",c="";if("thisMonth"==a){var d=new Date,e=d.getUTCFullYear(),f=d.getUTCMonth()+1;9>=f&&(f="0"+f),b=e+"-"+f+"-01",c=e+"-"+f+"-31"}else"period"==a&&(b=$("#from").val(),c=$("#to").val());var g={Food:0,Clothing:0,Transportation:0,Entertainment:0},h=0,j=collection.find({date:{$gte:b,$lte:c}},{$orderBy:{date:1}});if($("tbody").html(""),0===j.length)$("tbody").append("<tr><td colspan='3' style='text-align:center'>No Data</td></tr>");else{for(var k=0;k<j.length;k++)$("#expenses tbody").append(`<tr><td>${j[k].date}</td><td>${j[k].name}</td><td>${j[k].price}</td><td><button type="button" class="btn btn-danger" onclick="removeRecord('${j[k]._id}')"><i class="fas fa-trash-alt"></i></button></td></tr>`),g[j[k].category]+=j[k].price/1,h+=j[k].price/1;for(key in g){var l=g[key];$("#category tbody").append(`<tr><td>${key}</td><td>${l}</td><td>${Math.round(100*(l/h))}%</td></tr>`)}$("#category tbody").append(`<tr><td colspan='3'>Total: ${h}</td></tr>`)}})},darkSwitch=document.getElementById("darkSwitch");initTheme(),darkSwitch.addEventListener("change",function(){resetTheme()});function initTheme(){var a=null!==localStorage.getItem("darkSwitch")&&"dark"===localStorage.getItem("darkSwitch");darkSwitch.checked=a,a?(document.body.setAttribute("data-theme","dark"),$(".ui").addClass("inverted"),$(".navbar").removeClass("navbar-light"),$(".navbar").removeClass("bg-light"),$(".navbar").addClass("navbar-dark"),$(".navbar").addClass("bg-dark")):(document.body.removeAttribute("data-theme"),$(".ui").removeClass("inverted"),$(".navbar").removeClass("navbar-dark"),$(".navbar").removeClass("bg-dark"),$(".navbar").addClass("navbar-light"),$(".navbar").addClass("bg-light"))}function resetTheme(){darkSwitch.checked?(document.body.setAttribute("data-theme","dark"),$(".ui").addClass("inverted"),$(".navbar").removeClass("navbar-light"),$(".navbar").removeClass("bg-light"),$(".navbar").addClass("navbar-dark"),$(".navbar").addClass("bg-dark"),localStorage.setItem("darkSwitch","dark")):(document.body.removeAttribute("data-theme"),$(".ui").removeClass("inverted"),$(".navbar").removeClass("navbar-dark"),$(".navbar").removeClass("bg-dark"),$(".navbar").addClass("navbar-light"),$(".navbar").addClass("bg-light"),localStorage.removeItem("darkSwitch"))}var callPage=a=>{$.ajax({url:a,type:"GET",dataType:"html",success:b=>{$("#"+nowPage.slice(0,-5)).attr("class","nav-item"),nowPage=a,$("#mainContainer").html(b),$("#"+a.slice(0,-5)).attr("class","nav-item active"),resetTheme(),callCheck()}})};callPage("home.html");
